{% extends 'financas/base.html' %}

{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'financas/css/pagamentos.css' %}">
  <script src="{% static 'js/pagamentos.js' %}"></script>
{% endblock %}

{% block title %}Pagamentos{% endblock %}

{% block content %}
<div class="container">
    <header class="header">
        <h1 class="titulo-pagina">Pagamentos</h1>
        <button class="btn-adicionar" onclick="abrirModalNovoPagamento()">
            <i class="fas fa-plus"></i>
            Adicionar Pagamento
        </button>
    </header>

    <main class="conteudo-principal">
        {% if pagamentos_atrasados %}
        <div class="alerta-atraso">
            <p>Você tem {{ pagamentos_atrasados.count }} pagamento{{ pagamentos_atrasados.count|pluralize }} atrasado{{ pagamentos_atrasados.count|pluralize }}</p>
        </div>
        {% endif %}

        <section class="secao-pagamentos">
            <h2 class="titulo-secao">Hoje</h2>
            {% for pagamento in pagamentos_hoje %}
            <div class="card-pagamento">
                <div class="data-box">
                    <div class="data-mes">{{ pagamento.data_vencimento|date:"M" }}</div>
                    <div class="data-dia">{{ pagamento.data_vencimento|date:"d" }}</div>
                </div>
                <div class="info-pagamento">
                    <div class="titulo-pagamento">{{ pagamento.titulo }}</div>
                    <div class="detalhes-pagamento">
                        <span>{{ pagamento.get_status_display }}</span>
                        <span>{{ pagamento.data_vencimento|date:"d M, Y" }}</span>
                    </div>
                </div>
                <div class="valor-pagamento">
                    <div class="frequencia">{{ pagamento.get_frequencia_display }}</div>
                    <div class="valor">R$ {{ pagamento.valor|floatformat:2 }}</div>
                </div>
            </div>
            {% empty %}
            <p class="sem-pagamentos">Nenhum pagamento para hoje</p>
            {% endfor %}
        </section>

        <section class="calendario">
            <div class="header-calendario">
                <div class="mes-atual">
                    <span>{{ hoje|date:"F" }}</span>
                    <span>{{ hoje|date:"Y" }}</span>
                </div>
            </div>

            <div class="info-calendario">
                <div class="evento-calendario">
                    <i class="fas fa-file-invoice"></i>
                    <span>{{ total_pagamentos_mes }} pagamentos este mês</span>
                </div>
                <div class="evento-calendario">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Total: R$ {{ valor_total_mes|floatformat:2 }}</span>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Modal Novo Pagamento -->
<div id="modalNovoPagamento" class="modal">
    <div class="modal-conteudo">
        <span class="fechar-modal" onclick="fecharModalNovoPagamento()">&times;</span>
        <h2>Adicionar Novo Pagamento</h2>
        <form id="formNovoPagamento" onsubmit="salvarNovoPagamento(event)">
            {% csrf_token %}
            <div class="form-grupo">
                <label for="titulo">Título</label>
                <input type="text" id="titulo" name="titulo" required>
            </div>
            <div class="form-grupo">
                <label for="valor">Valor</label>
                <input type="number" id="valor" name="valor" step="0.01" required>
            </div>
            <div class="form-grupo">
                <label for="data_vencimento">Data de Vencimento</label>
                <input type="date" id="data_vencimento" name="data_vencimento" required>
            </div>
            <div class="form-grupo">
                <label for="frequencia">Frequência</label>
                <select id="frequencia" name="frequencia" required>
                    <option value="unica">Única</option>
                    <option value="mensal">Mensal</option>
                    <option value="anual">Anual</option>
                </select>
            </div>
            <button type="submit" class="btn-adicionar">Salvar</button>
        </form>
    </div>
</div>
{% endblock %}
