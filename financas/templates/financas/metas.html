{% extends 'financas/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'financas/css/metas.css' %}">
<script src="{% static 'js/metas.js' %}"></script>
{% endblock %}

{% block content %}
<div class="painel-metas">
    <div class="container-metas">
        <div class="cabecalho">
            <h1 class="titulo-pagina">Minhas Metas</h1>
            <button class="botao-adicionar-meta" onclick="abrirModalMeta()">
                <span class="icone-adicionar">+</span>
                Adicionar Nova Meta
            </button>
        </div>
        
        <div class="grade-metas">
            {% for meta in metas %}
            <div class="cartao-meta">
                <div class="imagem-cartao" {% if meta.imagem %}style="background-image: url('{{ meta.imagem.url }}')"{% endif %}>
                    <div class="sobreposicao-imagem sobreposicao-{{ meta.categoria.cor|default:'padrao' }}"></div>
                </div>
                <div class="conteudo-cartao">
                    <div class="detalhes-meta">
                        <span class="tag-categoria {{ meta.categoria.cor|default:'padrao' }}">
                            {{ meta.categoria.nome|default:"Sem categoria" }}
                        </span>
                        <h3 class="titulo-meta">{{ meta.titulo }}</h3>
                        <div class="valores-meta">
                            <span class="valor-atual">R$ {{ meta.valor_atual|floatformat:2 }}</span>
                            <span class="valor-meta">R$ {{ meta.valor_meta|floatformat:2 }}</span>
                        </div>
                    </div>
                    <div class="barra-progresso">
                        <div class="progresso" style="width: {{ meta.porcentagem_concluida }}%"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Modal Meta -->
<div id="modalMeta" class="modal">
    <div class="conteudo-modal">
        <div class="cabecalho-modal">
            <h2>Qual é a sua meta?</h2>
            <button type="button" class="botao-fechar" onclick="fecharModalMeta()">&times;</button>
        </div>
        <form method="post" action="{% url 'criar-meta' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="upload-imagem">
                <label for="imagem">
                    <div class="placeholder-upload">
                        <i class="icone-imagem"></i>
                        <span>Adicionar imagem</span>
                    </div>
                </label>
                <input type="file" id="imagem" name="imagem" accept="image/*" hidden>
            </div>
            
            <div class="grupo-form">
                <label for="titulo">Título*</label>
                <input type="text" id="titulo" name="titulo" required 
                       placeholder="ex: comprar um carro" class="input-padrao">
            </div>
            
            <div class="grupo-form">
                <label for="valor_meta">Valor da meta*</label>
                <div class="input-valor">
                    <span class="prefixo-valor">R$</span>
                    <input type="number" id="valor_meta" name="valor_meta" 
                           step="0.01" required class="input-padrao"
                           placeholder="0,00">
                </div>
            </div>
            
            <div class="grupo-form">
                <label for="categoria">Categoria (opcional)</label>
                <select id="categoria" name="categoria" class="input-padrao">
                    <option value="">selecionar a categoria</option>
                    {% for categoria in categorias %}
                    <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="botao-criar">Cria meta</button>
        </form>
    </div>
</div>
{% endblock %}
